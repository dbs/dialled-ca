<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Thompson-Nicola Regional District Library System</title>

<link rel="stylesheet" type="text/css" href="/resources/styles/tnls.css" />



</head>

<body>

<!--	header frame	-->
				
		<!--	header one	-->
				<div id="h1"  style="background-color:#e5e6e4;height:40px; overflow:hidden">
                    <div class="margin"> 
                        <a name="top" style="float:left">&nbsp;</a>
                        <div class="font0 menu_h r_corners_light button1" style="padding:7px;padding-left:10px;padding-right:10px;float:right; margin-top:5px">
                            <a id="_my_account" href="javascript:my_account();void(0)" target="_parent">My Account</a>
                        </div>
                        <a name="top" style="float:left">&nbsp;</a>
                       
                        

                        <ul style="float:right; margin-top:8px">
                           <li class="font1 menu_h"><a href="/?p=/pages/home/">home</a></li>
                           <li class="font1 menu_h"><a href="/?p=/pages/branches/kamloops.html">branches</a></li>
                           <li class="font1 menu_h"><a href="/?p=/pages/contact/">contact</a></li>
                           <li class="font1 menu_h"><a href="/?p=/pages/about/jobs/">about</a></li>
                           <li class="font1 menu_h"><a href="/?p=/pages/help/borrowing/">help</a></li>
                           
                        </ul>
                    
                    </div>
                </div>
                
		<!--	header two	-->                
                <div id="h2" style="height:105px; overflow:hidden" class="margin">
                <!--	logo	-->
                		<a href="/?p=/pages/home/" style="background:url(resources/images/tnls_sprite.jpg) no-repeat; height:66px; width:328px; margin-right:15px; float:left; margin-top:20px">&nbsp;</a>
                <!--	menu	--> 
                             <a href="/?p=/pages/ask_librarian/">
                            <div style="background:url(resources/images/tnls_sprite.jpg) no-repeat -348px 0px; height:37px; width:106px; float:right;margin-top:33px; ">
                                &nbsp;
                            </div></a>    
                            <ul style="float:right; margin-top:40px; margin-right:25px">
                               <li class="font3 menu_h"><a style=" color: #696969" href="/?p=/pages/find/catalogue/">Find</a></li>
                               <li class="font3 menu_h"><a style=" color: #696969" href="/?p=/pages/kids_teens/under_5/">Kids & Teens</a></li>
                               <li class="font3 menu_h"><a style=" color: #696969" href="/?p=/pages/programs_events/">Programs & Events</a></li>
                            </ul>    
						
                </div>
                
<!--	body frame	-->
		<!--	subpage place holder	-->
        		<div id="ifrm" ></div>
                <!--	reduce jitter--><div id="body"  style="min-height:500px"><div style=" background-color:#546437; height:90px"> &nbsp;</div></div>
                 
                   
                
        		
<!--	footer	-->

		<div id="f1" class="bar_lighter font1" style="margin-top:50px;border:1px solid #CCC; overflow:hidden" >
            	<div style="padding-top:12px;padding-bottom:12px;" class="margin font1">&copy; 2012 Thompson-Nicola Regional District Library System</div>
        </div>
        
        <div id="f2" class="bar_lightest font1" style="overflow:hidden; height:290px" ><br /><br />            
             <div class="margin" style="overflow:hidden"> 
                 
                 <ul class="footer_col r_border" style="padding-left:0px">
                 	<li><div class="font3" style="margin-bottom:10px"><a href="/?p=/pages/home/"  target="_blank">Home</a></div></li><br />
                	<li><div class="font3" style="margin-bottom:10px"><a href = "/?p=/pages/branches/kamloops.html">Branches</a></div></li><br />
                    <li><div class="font3" style="margin-bottom:10px"><a href="/?p=/pages/contact/">Contact</a></div></li><br />
                    <li><div class="font3" style="margin-bottom:10px; overflow:hidden">
                    	
                    </li>
                    
                   
                </ul>
                
                <ul class="footer_col r_border">
                	<li><div class="font3" style="margin-bottom:10px">About</div></li><br />
                	<li><a class="font1" href = "/?p=/pages/about/jobs/">Jobs</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/about/volunteer/">Volunteer</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/about/policies/">Policies</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/about/intellectual/">Intellectual Freedom</a></li><br />
                </ul>
                
                <ul class="footer_col r_border">
                	<li><div class="font3" style="margin-bottom:10px">Help</div></li><br />
                	<li><a class="font1" href = "/?p=/pages/help/borrowing/">Borrowing</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/help/donations/">Donations</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/help/services/">FAQ</a></li><br />
                </ul>
                
                <ul class="footer_col r_border">
                	<li><div class="font3" style="margin-bottom:10px">Find</div></li><br />
                	<li><a class="font1" href = "/?p=/pages/find/catalogue/">Catalogue</a></li><br />
                    <li><a class="font1" href ="/?p=/pages/find/online_resources/">Online Resources</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/find/services/">Services</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/find/esl_literacy/">ESL & Literacy</a></li><br />
                </ul>
                
               <ul class="footer_col r_border">
                	<li><div class="font3" style="margin-bottom:10px">Kids & Teens</div></li><br />
                	<li><a class="font1" href = "/?p=/pages/kids_teens/under_5/">Under 5</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/kids_teens/kids_zone/">Kid Zone</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/kids_teens/teens_only/">Teens Only</a></li><br />
                    <li><a class="font1" href = "/?p=/pages/kids_teens/parents_teachers/">Parent & Teachers</a></li><br />
                </ul>
                
                <ul class="footer_col r_border" >
                  
                	<li><div class="font3" style="margin-bottom:10px">Programs & Events</div></li><br />
                	<li>
                    	<select id="_location"  name = "location" style="width:170px; margin-bottom:10px;  ">
                        	<option value = "All">All Branches</option>
                            <option value = "Ashcroft">Ashcroft</option><option value = "Barriere">Barriere</option>
                            <option value ="Blue River">Blue River</option><option value = "Bookmobile">Bookmobile</option>
                            <option value = "Cache Creek">Cache Creek</option><option value = "Chase">Chase</option>
                            <option value = "Clearwater">Clearwater</option><option value = "Clinton">Clinton</option>
                            <option value = "Kamloops">Kamloops</option><option value = "Logan Lake">Logan Lake</option>
                            <option value = "Lytton">Lytton</option><option value = "Merritt">Merritt</option>
                             <option value = "North Kamloops">North Kamloops</option><option value = "Outreach Services">Outreach Services</option>
                             <option value = "Savona">Savona</option>
                        </select><br />
                        <select  id="_category" name = "category" style="width:170px; margin-bottom:10px ">
                        	<option value = "0">All Categories</option>
                              <option value = "10">After School Club</option>
                            <option value = "2">Announcements</option> 
                            <option value = "1">Author Talks</option>
                            <option value = "3">Book Clubs</option>
                            <option value = "16">Book Sales</option>
                            <option value = "26">Children Special Events</option>
                            <option value = "5">Computer Classes</option>
                            <option value = "14">Contests</option>
                                         
            				
                             <option value = "12">Craft Club</option>
                             <option value = "23">Events</option>
                             <option value = "27">Family Playroom</option>
                             <option value = "11">Family Storytime</option>
                             <option value = "20">Lego Club</option>
                             <option value = "8">Parent-Child Mother Goose</option>
                            <option value = "4">Pre-School Storytime</option> 
                             <option value = "9">Rock-a-Bye Baby</option>
                             <option value = "19">Story Dog</option>
                             <option value = "6">Summer Reading Clubs</option>
                             
                             <option value = "17">Teen Programs</option>
                             <option value = "18">Tiny Tunes</option>
                             <option value = "28">Tweens on Wednesday</option>	         
                        </select><br />
                        <input type="button" value="See Programs"  style="float:right" onclick="get_programs()"  />
                    
                    </li>
                </ul>
                
                <a style="float:left; margin-left:2px" href="http://www.facebook.com/TNRDLibrarySystem" target="_blank"> 
                    		<img src="resources/images/facebook.png" style="height:38px; width:38px; margin-top:5px; margin-left:5px; border:none" />
                    	</a>
                         <a style="float:left;" href="https://twitter.com/TNRD" target="_blank"> 
                    		<img src="resources/images/twitter.png" style="height:38px; width:38px; margin-top:5px; margin-left:6px; border:none" />
                    	</a>
                        
 			
            
            
            
            </div>
           
            	
        
        </div>
</body>
</html>
<script type="text/javascript" src="/resources/scripts/js/tnls.js" language="javascript"></script>
<script type="text/javascript" >

var dynamic_pages 	= new Array('/pages/find/catalogue/','/pages/find/catalogue/record.html','/pages/account/','/pages/account/bookbags/','/pages/account/holds/','/pages/account/checked_out/','/pages/account/fines/','/pages/account/holds/place/','/pages/find/catalogue/index_test.html','/pages/account/iii/lists/','/pages/teens/summer_challenge/approve/index.html','/pages/teens/summer_challenge/gallery/index.html','/pages/teens/summer_challenge/gallery/','/pages/teens/summer_challenge/approve/','/pages/teens/summer_challenge/approve/edit.html')

var account_pages 	= new Array('/pages/find/catalogue/')


var auth_pages 		= new Array();
var iframe_url		= '';
var cb_default		= '/?p=/pages/account/';
var logout_callback = cb_default

var intval			= "";
var session_time	= 300000;
//var url 	= location.search.replace('?','').split('&')[0].split('&')[0].split('=')[1]

url 		= location.search.split('p=')[1];
url 		= typeof url == 'undefined' ? '/pages/home/' : url;
url			= url+''+location.hash;


iframe_url 	= url;
logout_callback = '/?p=/pages/account/login.html?cb=/?p='+url;




function my_account(){		
window.open('https://rhodes.tnrdlib.ca/iii/cas/login?service=https%3A%2F%2Fdiscover.tnrdlib.ca%3A443%2Fiii%2Fencore%2Fj_acegi_cas_security_check&lang=eng','_blank');
		
/*
	if(is_active()){
		window.location.href = '/?p=/pages/account/' 
	}else{
		window.location.href = '/?p=/pages/account/login.html'
	}
	*/
}

function my_bookbag(){
	window.location.href = '/?p=/pages/account/iii/lists/login.html' 

/*
	if(is_active()){
		window.location.href = '/?p=/pages/account/' 
	}else{
		window.location.href = '/?p=/pages/account/login.html'
	}
	*/
}


if( $.inArray(url.split('?')[0],dynamic_pages) == -1){
	
	var iframe = $('<iframe name="b" id="b" src="'+ url +
				   			'" style=" width:100%; " frameborder="0" onload="$(this).height($(this).contents().height())"></iframe>').appendTo('#ifrm')
	$("#body").hide();
}else{
	get(url,true,'',function(data){$("#body").html(data)})	
}

if(getCookie('session_id') != "" || getCookie('session_id') != null){
	if(elapsed_session_time() < session_time){
		intval = window.setInterval(invoke_session_timer, session_time);
	}else{
		clear_session()
	}
}


// For other good browsers.

//$('iframe').load(function() {$(this).height($(this).contents().height()+'px')});

function login(auth_id,auth_usr,cb_url,reset){
	clear_session()
	setCookie('session_id',auth_id);
	setCookie('session_time', new Date())
	var place_hold	= cb_url.split('/pages/account/holds/place/').length  > 1 ? true :false;
	var add_bookbag	= cb_url.split('/pages/account/bookbags/add/').length > 1 ? true :false;
	if(reset){
		window.parent.document.location = '/?p=/pages/account/password_reset.html?cb='+ cb_url
	}else{
		if(place_hold || add_bookbag){
			window.parent.document.location.href = cb_url;
		}else{
			window.parent.document.location.href = auth_usr == getCookie('session_usr') ? cb_url : cb_default;
		}
	}
}

function is_active(){
	return getCookie('session_id') == '' || getCookie('session_id') == null? false : true
}

function set_cb(cb){
	logout_callback = cb
}

function logout_session(){
	clear_session()
	if(logout_callback.split('/pages/find/catalogue/index.html?s=').length > 1 || logout_callback.split('/pages/find/catalogue/?s=').length > 1 ||
							 														 logout_callback.split('cb=/?p=/pages/account/').length > 1){
		window.document.location.href = logout_callback
	}
}

function refresh_session(action){
	
	var session_id = getCookie('session_id')
	
	if(session_id != null && session_id != '' && session_id != 'null'){
		
		var args =  {
				'locale':'en-CA',
				'method':'open-ils.auth.session.retrieve',
				'param': '"'+session_id+'"',
				'service':'open-ils.auth'
		}
		osrf_gatway_call(args,true,function(data){
				var fields 		= data.payload[0].__p;
				//var session_usr = "usr = {id:"+fields[28]+",usrname:'"+fields[47]+",name:'"+fields[26]+"',email:'"+fields[22]+"',phone:'"+ fields[20] +"',org:'"+fields[27]+"'}"
				setCookie('session_org', fields[27])
				setCookie('session_usr', fields[47])
				setCookie('session_usr_id', fields[28])
				setCookie('session_time', new Date())
				action(fields,session_id);
			}, function(xhr) {xhr.setRequestHeader("X-OILS-Authtoken",session_id)}
		)
		
	}else{
		logout_session()
	}

	
}

function clear_session(){
	
//	clear cookies
	setCookie('session_desc',"Logged out")
	setCookie('session_status','expired')
	setCookie('session_id','')
	setCookie('session_usr_id', '')
	setCookie('session_time', '')
	setCookie('session_org', '')
	//setCookie('session_usr', '')
}

function elapsed_session_time(){
	var last_refreash = new Date(getCookie('session_time'));
	var current_time  = new Date();	
	var ms 		= current_time - last_refreash;
	var x  		= ms / 1000
	var seconds = x % 60
	x /= 60
	//return parseInt(x % 60)
	return parseInt(ms)
}

function invoke_session_timer(){
	logout_session()
}

function get_programs(){
	window.location.href = '/?p=/pages/programs_events/cat_loc.php?location='+$('#_location').val()+'&category='+$('#_category').val()
}

function is_opac(){
	return false;
}
</script>
